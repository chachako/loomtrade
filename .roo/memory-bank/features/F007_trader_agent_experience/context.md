# Feature Context: 交易员 Agent 框架与经验决策 MVP (Trader Agent Framework & Experience-Based Decision MVP) (ID: F007_trader_agent_experience)
*Initialized by Feature-Lead on 2025-05-10 12:21:00*
*Refined by Feature-Lead on 2025-05-10 12:22:20*

## 1. Overview & Goal
本功能的核心目标是构建交易员 Agent 的基础框架，并实现一个基于历史经验进行决策的最小可行产品 (MVP) 逻辑。
交易员 Agent 框架应包括：
1.  接收来自分析师 Agent (如 F006) 的交易信号或市场分析摘要的能力。
2.  与 System Orchestrator Agent (F002) 的标准通信接口，用于接收用户指令或报告状态。
3.  调用 ToolExecutor (F004) 和 Binance Connector (F005) 执行实际交易操作（如下单、查询订单、管理仓位）的能力。
4.  管理自身状态、风险参数（如最大仓位、止损点）和交易历史的机制。
基于历史经验的决策 MVP 逻辑应能：
1.  记录历史交易（成功/失败、参数、市场条件等）到其记忆库 (需与 F008 协调)。
2.  在接收到新的交易信号时，能够查询历史相似场景，并基于简化的历史经验（例如，过去类似信号的成功率）调整交易决策（例如，调整下单量、更严格的止损）。
目标是创建一个能够结合分析信号和自身经验进行交易决策并执行交易的专用 Agent。

## 2. Detailed Requirements / User Stories

### 2.1. 交易员 Agent 框架
*   **US-TA-001**: 作为一个交易员 Agent，我希望能够解析来自分析师 Agent (F006) 的标准化交易信号（包括但不限于：交易对、方向、入场价格建议、止损建议、止盈建议、信号置信度、分析摘要），以便准确理解交易建议。
*   **US-TA-002**: 作为一个交易员 Agent，我希望能够根据接收到的交易信号、预设的风险参数（如最大仓位、单笔最大亏损）以及（可选的）基于经验的调整，决定是否执行交易以及交易的规模和具体参数。
*   **US-TA-003**: 作为一个交易员 Agent，我希望能够通过 ToolExecutor (F004) 调用 Binance Connector (F005) 的工具来下达市价单、限价单，并设置止损单（如止损市价单、止损限价单）。
*   **US-TA-004**: 作为一个交易员 Agent，我希望能够通过 ToolExecutor (F004) 调用 Binance Connector (F005) 的工具来查询当前持仓详情、活动订单状态以及账户余额。
*   **US-TA-005**: 作为一个交易员 Agent，我希望能够管理自身的内部状态，包括当前的风险暴露、活跃的交易、以及关键的风险参数配置。
*   **US-TA-008**: 作为一个交易员 Agent，我希望能通过与 System Orchestrator Agent (F002) 的标准接口接收用户指令（例如，调整风险参数、手动平仓指令、暂停/恢复交易）并报告我的当前状态、关键决策和执行的交易。

### 2.2. 基于历史经验的决策 MVP
*   **US-TA-006**: 作为一个交易员 Agent，我希望能够将每一笔已完成的交易（包括原始信号、决策时使用的参数、订单执行详情、最终盈亏、平仓时的市场状况快照）结构化地记录到我的经验库中（与 F008_agent_memory_mgt 协调）。
*   **US-TA-007**: 作为一个交易员 Agent，在收到新的交易信号时，我希望能查询经验库中与当前信号在关键特征（例如，信号来源 Agent 类型、交易对、信号方向、关键指标模式如“金叉”）上相似的历史交易记录。
*   **US-TA-009 (MVP Decision Logic)**: 作为一个交易员 Agent，我希望能根据最近 N 次（例如 N=10）相似历史交易的聚合成功率（例如，盈利交易次数 / N）来调整当前交易的下单量：
    *   如果成功率低于阈值 P1 (例如 40%)，则将计划交易量减少 R1 (例如 50%)。
    *   如果成功率高于阈值 P2 (例如 70%)，则可将计划交易量增加 R2 (例如 25%)，但总风险不超过预设上限。
    *   如果成功率介于 P1 和 P2 之间，则按标准计划交易量执行。
*   **US-TA-010 (MVP Risk Adjustment)**: 作为一个交易员 Agent，我希望能根据最近 N 次相似历史交易的平均盈利/亏损比，以及最大回撤情况，来考虑是否需要调整止损点的设置（例如，若近期同类信号平均亏损较大，则适当收紧止损）。

## 3. Acceptance Criteria

### 3.1. 交易员 Agent 框架
*   **AC-TA-001.1**: 给定一个来自分析师 Agent 的有效交易信号（JSON 或特定格式），交易员 Agent 能够成功解析并提取所有定义的字段。
*   **AC-TA-002.1**: 给定一个交易信号和一套风险参数，交易员 Agent 能够根据其内部逻辑输出一个明确的交易决策（执行或不执行）以及（若执行）详细的订单参数（交易对、数量、价格、订单类型、止损设置）。
*   **AC-TA-003.1**: 当交易员 Agent 决定执行交易时，它能够成功地通过 ToolExecutor 和 Binance Connector 在模拟或真实盘面下达一个市价单，并且该订单的状态能够被正确追踪。
*   **AC-TA-003.2**: 当交易员 Agent 决定执行交易时，它能够成功地通过 ToolExecutor 和 Binance Connector 在模拟或真实盘面下达一个限价单，并附带一个止损单。
*   **AC-TA-004.1**: 交易员 Agent 能够通过工具调用成功获取并更新其当前在特定交易对上的持仓信息（若有）。
*   **AC-TA-008.1**: 交易员 Agent 能够响应来自 System Orchestrator Agent 的“查询状态”指令，并返回其当前的关键参数和活动摘要。

### 3.2. 基于历史经验的决策 MVP
*   **AC-TA-006.1**: 在一笔模拟交易完成后，交易员 Agent 能够生成一条包含所有预定义字段的经验记录，并成功提交给经验库（F008）。
*   **AC-TA-007.1**: 给定一个新的交易信号 S 和一个包含 M 条历史交易记录的经验库，当交易员 Agent 查询相似历史交易时，系统能基于预定义的相似性标准（例如，交易对相同、信号方向相同、信号来源 Agent 类型相同）筛选出相关的历史记录子集。
*   **AC-TA-009.1**: 给定一个交易信号和一组相似历史交易记录（例如10条），其中4条盈利，当 P1=50% 且 R1=50% 时，交易员 Agent 计算出的调整后交易量应为原计划的50%。
*   **AC-TA-009.2**: 给定一个交易信号和一组相似历史交易记录（例如10条），其中8条盈利，当 P2=70% 且 R2=25% 时，交易员 Agent 计算出的调整后交易量应为原计划的125%（不超过最大风险限制）。
*   **AC-TA-010.1**: (待细化) 给定一组相似历史交易，若其平均亏损额超过预设阈值，交易员 Agent 的决策日志中应体现出对止损策略的考量或调整。

## 4. Scope
### 4.1. In Scope:
*   Trader Agent 基础框架设计与实现。
*   与 F002, F004, F005, F006, F008 的基本接口定义与集成（MVP 级别）。
*   标准交易信号的接收与解析。
*   基于固定风险参数的交易决策逻辑。
*   通过工具执行市价单、限价单、止损单。
*   查询订单、持仓、余额。
*   结构化交易经验的记录。
*   MVP 级别的基于历史成功率调整交易量的决策逻辑。
*   基本的 Agent 状态管理。
### 4.2. Out of Scope:
*   复杂的动态风险管理模型（例如，基于市场波动率实时调整风险参数）。
*   高级的经验学习算法（例如，强化学习、复杂的模式识别）。
*   多种复杂订单类型的同时管理与协同。
*   多账户管理。
*   用户自定义经验决策规则的界面或复杂配置。
*   实时性能优化到微秒级别。

## 5. Technical Notes / Assumptions
*   交易信号格式将与 F006 (Analyst Agent) 协商确定。
*   经验存储格式和查询接口将与 F008 (Agent Memory Mgt) 协商确定。
*   Binance API 的速率限制和行为是已知的。
*   MVP 阶段，"相似场景" 的定义将相对简单，基于少数几个关键特征。
*   所有交易决策和执行都会有详细日志记录。
*   初始版本将主要在模拟盘进行测试。