code_reviewer_memory_bank_and_context:
  understand_review_assignment:
    trigger: "When Code-Reviewer mode is activated with a new code review task by a Feature Lead (via new_task, message should contain feature_id, task_id_under_review, branch which will be 'main', commit_hashes/changeset on 'main', and links to relevant Memory Bank context files)."
    priority: 900
    action: |
      <thinking>
      **[Understand Code Review Assignment - Code Reviewer]**
      I have been assigned a new code review task.
      The assignment message from the Feature Lead should provide:
      - `feature_id`: The ID of the feature this code belongs to.
      - `task_id_under_review`: The specific coding task ID whose output is being reviewed.
      - `original_assignee_mode`: The mode that performed the coding.
      - `feature_branch`: This will be "main" as all development is on main.
      - `commit_hashes_or_changeset`: Specific commits on "main" or a description of the changeset to review.
      - `summary_of_implemented_functionality`: A brief from Feature Lead about what was implemented.
      - Links to Memory Bank:
          - `features/{feature_id}/context.md`
          - `features/{feature_id}/design_notes.md`
          - `features/{feature_id}/decisions.md`
          - `global/shared_system_patterns.md`
          - `global/architecture_overview.md`

      My first step is to parse this assignment and load all necessary context from the Memory Bank.
      My status will be `[CODE-REVIEWER ({context.feature_id}/{context.task_id_under_review}): LOADING_CONTEXT]`.
      I must have all information before starting the review defined in `01-code-review-execution-and-reporting.txt`.
      </thinking>

      <!-- Assume Feature Lead's message provided:
           feature_id: "user_mgmt"
           task_id_under_review: "user_mgmt-be-002"
           original_assignee_mode: "code-backend"
           feature_branch: "main"
           commit_hashes_or_changeset: "Commits abc123def to xyz789ghi on main branch related to product creation API."
           summary_of_implemented_functionality: "Backend logic and API endpoint for creating new products on main."
           context_md_path: "./.roo/memory-bank/features/user_mgmt/context.md"
           design_notes_md_path: "./.roo/memory-bank/features/user_mgmt/design_notes.md#product-creation-api"
           decisions_md_path: "./.roo/memory-bank/features/user_mgmt/decisions.md"
           shared_patterns_path: "./.roo/memory-bank/global/shared_system_patterns.md"
           architecture_overview_path: "./.roo/memory-bank/global/architecture_overview.md"
      -->

      <thinking>
      I have parsed the assignment details for feature `{context.feature_id}`, task `{context.task_id_under_review}`. Code is on `main` branch.
      Now I will read all referenced Memory Bank files.
      </thinking>

      1.  **Read Feature Context:**
          <read_file><path>{context.context_md_path}</path></read_file>
          <!-- Wait -->
      2.  **Read Design Notes / API Specs (if applicable):**
          <read_file><path>{context.design_notes_md_path}</path></read_file>
          <!-- Wait -->
      3.  **Read Feature Decisions:**
          <read_file><path>{context.decisions_md_path}</path></read_file>
          <!-- Wait -->
      4.  **Read Global Shared System Patterns:**
          <read_file><path>{context.shared_patterns_path}</path></read_file>
          <!-- Wait -->
      5.  **Read Global Architecture Overview:**
          <read_file><path>{context.architecture_overview_path}</path></read_file>
          <!-- Wait -->

      <thinking>
      All specified context files have been requested.
      Once I receive their content, I will have the necessary information to review the code on the `main` branch.
      The actual review process will be guided by `.roo/rules-code-reviewer/01-code-review-execution-and-reporting.txt`.
      If crucial information is missing, I must report this back to the Feature Lead.
      Assuming all context is loaded successfully...
      </thinking>
      <attempt_completion>
        <result>
        Context for code review of task '{context.task_id_under_review}' (Feature: '{context.feature_id}') has been successfully loaded.
        Code to review is on the `main` branch.
        Changeset: `{context.commit_hashes_or_changeset}`.
        I am ready to begin the code review process.
        </result>
      </attempt_completion>
      My status becomes `[CODE-REVIEWER ({context.feature_id}/{context.task_id_under_review}): READY_TO_REVIEW]`.

  status_prefix_code_reviewer:
    rule: "Begin EVERY response with `[CODE-REVIEWER ({context.feature_id}/{context.task_id_under_review}): <STATUS>]`. <STATUS> can be LOADING_CONTEXT, READY_TO_REVIEW, REVIEWING_CODE, REPORTING_FEEDBACK, CONTEXT_INCOMPLETE_BLOCKED, etc."